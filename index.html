<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ›ä½œè€…åå¹´å˜åŒ–æ€»ç»“è¡¨</title>
    <style>
        :root {
            --bg-color: #F4F1EA;
            --text-dark: #2D4739;
            --title-dark: #121619;
            --accent-line: #BCB382;
            --highlight: #47340C;
        }

        body {
            font-family: "Microsoft YaHei", "PingFang SC", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-dark);
            margin: 0;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            box-sizing: border-box;
        }

        h1 { color: var(--title-dark); text-align: center; margin-bottom: 25px; font-size: 24px; }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            border-bottom: 2px solid var(--accent-line);
            margin-bottom: 20px;
            padding-bottom: 5px;
        }

        .tab-btn {
            padding: 8px 12px;
            cursor: pointer;
            border: 1px solid transparent;
            background: #fdfdfd;
            color: var(--text-dark);
            font-weight: bold;
            font-size: 14px;
            border-radius: 4px 4px 0 0;
            transition: 0.2s;
        }

        .tab-btn.active {
            border: 1px solid var(--accent-line);
            border-bottom: 3px solid var(--highlight);
            color: var(--highlight);
            background: rgba(71, 52, 12, 0.05);
        }

        .tab-content { display: none; padding: 10px 0; }
        .tab-content.active { display: block; }

        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 6px; color: var(--highlight); font-size: 14px; }

        input[readonly] {
            background-color: #f0f0f0;
            color: #777;
            cursor: not-allowed;
            border: 1px solid #ddd;
        }

        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--accent-line);
            border-radius: 6px;
            box-sizing: border-box;
            font-family: inherit;
            font-size: 14px;
        }

        .btn-generate {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: var(--highlight);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0;
        }

        /* éšè—åŸå§‹ Canvasï¼Œæ˜¾ç¤º IMG */
        #preview-canvas { display: none; }
        #final-image {
            width: 100%;
            height: auto;
            margin-top: 20px;
            border: 1px solid var(--accent-line);
            display: none; /* åˆå§‹éšè— */
        }

        .footer-info {
            background: #fcfbf7;
            padding: 15px;
            border-radius: 8px;
            border: 1px dashed var(--accent-line);
            margin-top: 25px;
            font-size: 13px;
            line-height: 1.6;
        }

        .footer-info h3 { margin: 0 0 10px 0; color: var(--highlight); font-size: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h1>âœï¸ åˆ›ä½œè€…åå¹´å˜åŒ–æ€»ç»“è¡¨</h1>

    <div class="tabs" id="tab-headers">
        <button class="tab-btn active" id="btn-base" onclick="showTab('base')">ğŸ“ åŸºç¡€ä¿¡æ¯</button>
    </div>

    <div id="tab-contents">
        <div class="tab-content active" id="content-base">
            <div class="form-group">
                <label>æ€»ç»“è¡¨æ ‡é¢˜ (ä¸å¯ç¼–è¾‘)</label>
                <input type="text" id="main-title" value="åˆ›ä½œè€…åå¹´å˜åŒ–æ€»ç»“è¡¨" readonly>
            </div>
            <div class="form-group">
                <label>åˆ¶è¡¨äºº (ä¸å¯ç¼–è¾‘)</label>
                <input type="text" id="main-creator" value="å—æå†°é›•å¸ˆ" readonly>
            </div>
            <div class="form-group">
                <label>å¡«è¡¨äºº</label>
                <input type="text" id="main-writer" placeholder="è¯·è¾“å…¥æ‚¨çš„ç¬”å">
            </div>
            <div class="form-group">
                <label>å¡«å†™æ—¶é—´</label>
                <input type="text" id="main-date">
            </div>
        </div>

        <div class="tab-content" id="content-export">
            <h3 style="color: var(--highlight); text-align:center;">ğŸ–¼ï¸ ç¡®è®¤æ‰€æœ‰å¹´ä»½å·²å¡«å†™å®Œæ¯•</h3>
            <button class="btn-generate" onclick="generateImage()">ç”Ÿæˆåå¹´æ€»ç»“é•¿å›¾</button>

            <canvas id="preview-canvas"></canvas>
            <img id="final-image" alt="ç”Ÿæˆçš„é•¿å›¾">
        </div>
    </div>

    <div class="footer-info">
        <h3>ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼š</h3>
        1. <b>æ•°æ®å®‰å…¨</b>ï¼šç³»ç»Ÿä¸ä¼šè‡ªåŠ¨ä¿å­˜å†…å®¹ï¼Œè¯·å‹¿åˆ·æ–°ç½‘é¡µï¼Œå»ºè®®åœ¨æœ¬åœ°å¤‡ä»½é•¿æ–‡æœ¬ã€‚<br>
        2. <b>å†…å®¹ç•™ç©º</b>ï¼šè‹¥æŸé¡¹ä¸å¡«ï¼Œå¯¼å‡ºå›¾ç‰‡æ—¶å°†è‡ªåŠ¨æ˜¾ç¤ºâ€œï¼ˆæš‚æ— å†…å®¹ï¼‰â€ã€‚<br>
        3. <b>æ‰‹æœºç«¯ä¿å­˜</b>ï¼šç‚¹å‡»â€œç”Ÿæˆâ€åï¼Œ<b>é•¿æŒ‰ä¸‹æ–¹å‡ºç°çš„å›¾ç‰‡</b>å³å¯å¼¹å‡ºç³»ç»Ÿèœå•é€‰æ‹©â€œä¿å­˜åˆ°ç›¸å†Œâ€ã€‚<br>
        4. <b>æœ€ä½³æ•ˆæœ</b>ï¼šå»ºè®®â€œé£æ ¼æ®µè½â€æ§åˆ¶åœ¨ 150-300 å­—å·¦å³ï¼Œä»¥è·å¾—ç¾è§‚çš„æ’ç‰ˆã€‚
    </div>
</div>

<script>
    const YEARS = Array.from({length: 10}, (_, i) => 2016 + i);
    const COLOR_BG = '#F4F1EA';
    const COLOR_TEXT = '#2D4739';
    const COLOR_TITLE = '#121619';
    const COLOR_ACCENT = '#BCB382';
    const COLOR_HIGHLIGHT = '#47340C';

    window.onload = () => {
        document.getElementById('main-date').value = new Date().toLocaleDateString('zh-CN', {year:'numeric', month:'long', day:'numeric'});
        const headers = document.getElementById('tab-headers');
        const contents = document.getElementById('tab-contents');

        YEARS.forEach(year => {
            const btn = document.createElement('button');
            btn.className = 'tab-btn';
            btn.innerText = `${year}`;
            btn.id = `btn-${year}`;
            btn.onclick = () => showTab(year);
            headers.appendChild(btn);

            const div = document.createElement('div');
            div.className = 'tab-content';
            div.id = `content-${year}`;
            div.innerHTML = `
                <h3 style="color: var(--highlight); margin-top:0;">ã€ ${year} å¹´åˆ›ä½œè®°å½• ã€‘</h3>
                <div class="form-group"><label>1. æœ¬å¹´æˆ‘åœ¨å†™ï¼š</label><textarea id="q1-${year}" rows="2" placeholder="ä½œå“ã€CPç­‰"></textarea></div>
                <div class="form-group"><label>2. æœ€èƒ½ä»£è¡¨æœ¬å¹´é£æ ¼çš„æ®µè½ï¼š</label><textarea id="q2-${year}" rows="6" placeholder="å»ºè®®150-300å­—"></textarea></div>
                <div class="form-group"><label>3. æœ¬å¹´å¯¹æˆ‘å½±å“æœ€å¤§çš„äº‹ï¼š</label><textarea id="q3-${year}" rows="2"></textarea></div>
                <div class="form-group"><label>4. æœ¬å¹´åˆ›ä½œæ€»ç»“æ„Ÿæƒ³ï¼š</label><textarea id="q4-${year}" rows="3"></textarea></div>
            `;
            contents.insertBefore(div, document.getElementById('content-export'));
        });

        const exportBtn = document.createElement('button');
        exportBtn.className = 'tab-btn';
        exportBtn.innerText = 'ğŸ–¼ï¸ å¯¼å‡º';
        exportBtn.id = 'btn-export';
        exportBtn.onclick = () => showTab('export');
        headers.appendChild(exportBtn);
    };

    function showTab(id) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById(`btn-${id}`).classList.add('active');
        document.getElementById(`content-${id}`).classList.add('active');
    }

    function wrapText(ctx, text, maxWidth) {
        const str = text || "(æš‚æ— å†…å®¹)";
        let lines = [];
        let currentLine = "";
        for (let char of str) {
            let testLine = currentLine + char;
            if (ctx.measureText(testLine).width > maxWidth) {
                lines.push(currentLine);
                currentLine = char;
            } else {
                currentLine = testLine;
            }
        }
        lines.push(currentLine);
        return lines;
    }

    function generateImage() {
        const canvas = document.getElementById('preview-canvas');
        const imgDisplay = document.getElementById('final-image');
        const ctx = canvas.getContext('2d');
        const W = 1600;
        const MARGIN = 60;
        const GUTTER = 50;
        const COL_W = (W - 2 * MARGIN - GUTTER) / 2;
        const TEXT_W = COL_W - 40;
        const LINE_H = 32;

        const calcYearH = (year) => {
            let h = 80;
            ctx.font = "20px sans-serif";
            const questions = [`q1-${year}`, `q2-${year}`, `q3-${year}`, `q4-${year}`];
            questions.forEach(id => {
                const lines = wrapText(ctx, document.getElementById(id).value, TEXT_W);
                h += 35 + lines.length * LINE_H + 20;
            });
            return h + 60;
        };

        let h_left = YEARS.slice(0, 5).reduce((acc, y) => acc + calcYearH(y), 0);
        let h_right = YEARS.slice(5).reduce((acc, y) => acc + calcYearH(y), 0);

        const H = 300 + Math.max(h_left, h_right) + 100;
        canvas.width = W;
        canvas.height = H;

        // ç»˜åˆ¶é€»è¾‘
        ctx.fillStyle = COLOR_BG;
        ctx.fillRect(0, 0, W, H);
        ctx.textAlign = "center";
        ctx.fillStyle = COLOR_TITLE;
        ctx.font = "bold 55px sans-serif";
        ctx.fillText(document.getElementById('main-title').value, W/2, 100);
        ctx.font = "22px sans-serif";
        ctx.fillStyle = COLOR_TEXT;
        ctx.textAlign = "left";
        ctx.fillText(`å¡«è¡¨äºº: ${document.getElementById('main-writer').value || "æœªå¡«å†™"}`, MARGIN, 160);
        ctx.textAlign = "center";
        ctx.fillText(`å¡«å†™æ—¶é—´: ${document.getElementById('main-date').value}`, W/2, 160);
        ctx.textAlign = "right";
        ctx.fillText(`åˆ¶è¡¨äºº: ${document.getElementById('main-creator').value}`, W - MARGIN, 160);
        ctx.strokeStyle = COLOR_TITLE;
        ctx.lineWidth = 2;
        ctx.beginPath(); ctx.moveTo(MARGIN, 195); ctx.lineTo(W - MARGIN, 195); ctx.stroke();

        const drawCol = (years, startX, startY) => {
            let y = startY;
            years.forEach(year => {
                ctx.textAlign = "left";
                ctx.fillStyle = COLOR_HIGHLIGHT;
                ctx.font = "bold 32px sans-serif";
                ctx.fillText(`ğŸŒŸ ã€ ${year} å¹´ åˆ›ä½œå°ç»“ ã€‘`, startX, y + 40);
                y += 85;
                const qs = [
                    {l: "1. æœ¬å¹´æˆ‘åœ¨å†™ï¼š", id: `q1-${year}`},
                    {l: "2. é£æ ¼æ®µè½ï¼š", id: `q2-${year}`},
                    {l: "3. é‡å¤§å½±å“ï¼š", id: `q3-${year}`},
                    {l: "4. æ€»ç»“æ„Ÿæƒ³ï¼š", id: `q4-${year}`}
                ];
                qs.forEach(q => {
                    ctx.fillStyle = COLOR_HIGHLIGHT;
                    ctx.font = "bold 24px sans-serif";
                    ctx.fillText(q.l, startX, y);
                    y += 35;
                    ctx.fillStyle = COLOR_TEXT;
                    ctx.font = "20px sans-serif";
                    const lines = wrapText(ctx, document.getElementById(q.id).value, TEXT_W);
                    lines.forEach(line => { ctx.fillText(line, startX + 15, y); y += LINE_H; });
                    y += 20;
                });
                ctx.strokeStyle = COLOR_ACCENT;
                ctx.lineWidth = 1;
                ctx.beginPath(); ctx.moveTo(startX + 50, y); ctx.lineTo(startX + COL_W - 50, y); ctx.stroke();
                y += 55;
            });
        };

        drawCol(YEARS.slice(0, 5), MARGIN, 240);
        drawCol(YEARS.slice(5), MARGIN + COL_W + GUTTER, 240);
        ctx.strokeStyle = COLOR_TITLE;
        ctx.lineWidth = 2;
        ctx.beginPath(); ctx.moveTo(W/2, 240); ctx.lineTo(W/2, H - 80); ctx.stroke();

        // --- æ ¸å¿ƒæ”¹åŠ¨ï¼šå°† Canvas å¯¼å‡ºä¸ºå›¾ç‰‡ ---
        try {
            const dataURL = canvas.toDataURL("image/png");
            imgDisplay.src = dataURL;
            imgDisplay.style.display = "block";
            window.scrollTo({ top: imgDisplay.offsetTop, behavior: 'smooth' });
        } catch (e) {
            alert("ç”Ÿæˆå›¾ç‰‡å¤±è´¥ï¼Œè¯·å°è¯•åœ¨ç”µè„‘ç«¯æ“ä½œã€‚");
        }
    }
</script>

</body>
</html>